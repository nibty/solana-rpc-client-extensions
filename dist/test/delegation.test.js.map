{"version":3,"sources":["../../test/delegation.test.ts"],"names":["test","getStakeActivatingAndDeactivating"],"mappings":"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","file":"delegation.test.js","sourcesContent":["import test from 'ava';\nimport { getStakeActivatingAndDeactivating } from '../src';\n\nexport interface StakeHistoryEntry {\n  epoch: bigint;\n  effective: bigint;\n  activating: bigint;\n  deactivating: bigint;\n}\n\nconst HUGE_NUM = 1_000_000_000_000_000n;\n\ntest('activating', (t) => {\n  const targetEpoch = 11n;\n  const stake = 10n;\n  const delegation = {\n    stake,\n    activationEpoch: targetEpoch,\n    deactivationEpoch: HUGE_NUM,\n    unused: 0n,\n    voterPubkey: new Uint8Array(),\n  };\n  const stakeHistory = [\n    {\n      epoch: targetEpoch - 1n,\n      effective: HUGE_NUM,\n      activating: HUGE_NUM,\n      deactivating: HUGE_NUM,\n    },\n  ];\n  const status = getStakeActivatingAndDeactivating(\n    delegation,\n    targetEpoch,\n    stakeHistory\n  );\n  t.is(status.activating, stake);\n  t.is(status.effective, 0n);\n  t.is(status.deactivating, 0n);\n});\ntest('effective', (t) => {\n  const targetEpoch = 11n;\n  const stake = 10n;\n  const delegation = {\n    stake,\n    activationEpoch: targetEpoch - 1n,\n    deactivationEpoch: HUGE_NUM,\n    unused: 0n,\n    voterPubkey: new Uint8Array(),\n  };\n  const stakeHistory = [\n    {\n      epoch: targetEpoch - 1n,\n      effective: HUGE_NUM,\n      activating: stake,\n      deactivating: HUGE_NUM,\n    },\n  ];\n  const status = getStakeActivatingAndDeactivating(\n    delegation,\n    targetEpoch,\n    stakeHistory\n  );\n  t.is(status.activating, 0n);\n  t.is(status.effective, stake);\n  t.is(status.deactivating, 0n);\n});\ntest('deactivating', (t) => {\n  const targetEpoch = 11n;\n  const stake = 10n;\n  const delegation = {\n    stake,\n    activationEpoch: targetEpoch - 1n,\n    deactivationEpoch: targetEpoch,\n    unused: 0n,\n    voterPubkey: new Uint8Array(),\n  };\n  const stakeHistory = [\n    {\n      epoch: targetEpoch - 1n,\n      effective: HUGE_NUM,\n      activating: stake,\n      deactivating: stake,\n    },\n  ];\n  const status = getStakeActivatingAndDeactivating(\n    delegation,\n    targetEpoch,\n    stakeHistory\n  );\n  t.is(status.activating, 0n);\n  t.is(status.effective, stake);\n  t.is(status.deactivating, stake);\n});\ntest('multi-epoch activation', (t) => {\n  const targetEpoch = 11n;\n  const stake = HUGE_NUM;\n  const delegation = {\n    stake,\n    activationEpoch: targetEpoch - 1n,\n    deactivationEpoch: HUGE_NUM,\n    unused: 0n,\n    voterPubkey: new Uint8Array(),\n  };\n  const stakeHistory = [\n    {\n      epoch: targetEpoch - 1n,\n      effective: HUGE_NUM,\n      activating: HUGE_NUM,\n      deactivating: HUGE_NUM,\n    },\n  ];\n  const status = getStakeActivatingAndDeactivating(\n    delegation,\n    targetEpoch,\n    stakeHistory\n  );\n  // all of the total amount activating, but only 9% allowed, so it'll activate 9%\n  const effective = (stake * 9n) / 100n;\n  t.is(status.activating, stake - effective);\n  t.is(status.effective, effective);\n  t.is(status.deactivating, 0n);\n});\ntest('multi-epoch deactivation', (t) => {\n  const targetEpoch = 11n;\n  const stake = HUGE_NUM;\n  const delegation = {\n    stake,\n    activationEpoch: targetEpoch - 2n,\n    deactivationEpoch: targetEpoch - 1n,\n    unused: 0n,\n    voterPubkey: new Uint8Array(),\n  };\n  const stakeHistory = [\n    {\n      epoch: targetEpoch - 2n,\n      effective: HUGE_NUM * 100n, // make sure it all activates in one epoch\n      activating: stake,\n      deactivating: stake,\n    },\n    {\n      epoch: targetEpoch - 1n,\n      effective: HUGE_NUM,\n      activating: HUGE_NUM,\n      deactivating: HUGE_NUM,\n    },\n  ];\n  const status = getStakeActivatingAndDeactivating(\n    delegation,\n    targetEpoch,\n    stakeHistory\n  );\n  // all of the total amount deactivating, but only 9% allowed, so it'll deactivate 9%\n  const deactivated = (stake * 9n) / 100n;\n  t.is(status.activating, 0n);\n  t.is(status.effective, stake - deactivated);\n  t.is(status.deactivating, stake - deactivated);\n});\n"]}